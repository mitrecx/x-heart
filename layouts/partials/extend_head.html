<!-- Hugo网站自定义样式和脚本 -->
<!-- 文件位置: layouts/partials/extend_head.html -->
<!-- 作用: 扩展PaperMod主题的默认样式，添加自定义功能 -->

<script>
// ========== 命令行代码块语法高亮增强 ==========
// 功能: 为shell代码块添加智能语法高亮，支持命令、选项、路径等元素的着色
// 注意: 仅对未被Chroma精细标注的代码行生效，避免覆盖已有的语法高亮
// 注意: 调试CSS时先检查HTML结构; 不要假设，要验证实际的DOM结构;
(function() {
  function wrapFirstCommandWord(line) {
    var PREFIX = /^(sudo|doas|time|command|nice|ionice|env)$/;
    // 小工具：收集行内的所有纯文本节点
    function collectTextNodes(root, out) {
      out = out || [];
      root.childNodes.forEach(function(n){
        if (n.nodeType === 3) out.push(n);
        else collectTextNodes(n, out);
      });
      return out;
    }
    // 小工具：根据整体偏移找到具体文本节点与内部偏移
    function locateByOffset(root, offset) {
      var nodes = collectTextNodes(root);
      var acc = 0;
      for (var i=0;i<nodes.length;i++) {
        var t = nodes[i];
        var len = t.nodeValue.length;
        if (offset <= acc + len) {
          return { node: t, inner: offset - acc };
        }
        acc += len;
      }
      return null;
    }

    // 先尝试：如果行首是命令或前缀，则高亮（兼容已有做法）
    var node = line.firstChild;
    var highlightedFirst = false;
    var needNextCmd = false;
    while (node) {
      if (node.nodeType === 3) { // 文本节点
        var txt = node.nodeValue;
        var mSpace = txt.match(/^(\s*)/);
        var leading = mSpace ? mSpace[0] : '';
        var rest = txt.slice(leading.length);
        if (rest.length === 0) { node = node.nextSibling; continue; }
        var mWord = rest.match(/^([A-Za-z0-9._-]+)/);
        if (mWord) {
          var cmd = mWord[1];
          var after = rest.slice(cmd.length);
          var frag = document.createDocumentFragment();
          if (leading) frag.appendChild(document.createTextNode(leading));
          var span = document.createElement('span');
          span.className = highlightedFirst ? 'tk-cmd' : (PREFIX.test(cmd) ? 'tk-prefix' : 'tk-cmd');
          span.textContent = cmd;
          frag.appendChild(span);
          if (after) frag.appendChild(document.createTextNode(after));
          var next = node.nextSibling;
          line.replaceChild(frag, node);
          highlightedFirst = true;
          if (PREFIX.test(cmd) && !needNextCmd) { needNextCmd = true; node = line.firstChild; continue; }
          if (needNextCmd) { break; }
          node = next;
          continue;
        }
      }
      node = node.nextSibling;
    }

    // 补充：如果包含 `! cmd` 结构，则用 Range 包裹 cmd
    try {
      var raw = line.textContent;
      var bang = raw.match(/!\s*([A-Za-z0-9._-]+)/);
      if (bang) {
        var word = bang[1];
        var idxBang = raw.indexOf(bang[0]);
        var idxWord = raw.indexOf(word, idxBang);
        if (idxWord >= 0) {
          var startLoc = locateByOffset(line, idxWord);
          var endLoc = locateByOffset(line, idxWord + word.length);
          if (startLoc && endLoc) {
            var range = document.createRange();
            range.setStart(startLoc.node, startLoc.inner);
            range.setEnd(endLoc.node, endLoc.inner);
            var wrap = document.createElement('span');
            wrap.className = 'tk-cmd';
            range.surroundContents(wrap);
          }
        }
      }
    } catch(e) { /* 忽略失败，保持原样 */ }
  }

  function enhanceShellBlocks() {
    var blocks = document.querySelectorAll('code.language-bash, code.language-sh');
    var PREFIX = /^(sudo|doas|time|command|nice|ionice|env)$/;
    blocks.forEach(function(code) {
      var lines = code.querySelectorAll('.line .cl');
      lines.forEach(function(line) {
        var raw = line.textContent;
        if (!raw || !raw.trim()) return;
        // 跳过注释行
        if (raw.trim().startsWith('#')) return;
        if (line.querySelector('span:not(.cl)')) {
          // 已有部分token：为首个命令词（及sudo等前缀后的下一个命令）补充高亮
          wrapFirstCommandWord(line);
          return;
        }
        // 否则进行完整的切分高亮
        var parts = raw.split(/(\s+)/);
        var frag = document.createDocumentFragment();
        var expectCmd = true; // 行首或管道/与/或 之后的第一个词视为命令名
        parts.forEach(function(part) {
          if (!part) return;
          if (/^\s+$/.test(part)) { frag.appendChild(document.createTextNode(part)); return; }
          var span = document.createElement('span');
          // 操作符
          if (/^(\|\||\||&&|>>?|<<?)$/.test(part)) { span.className = 'tk-op'; expectCmd = true; }
          // 前缀命令（sudo 等），同时让下一个词也按命令处理
          else if (PREFIX.test(part)) { span.className = 'tk-prefix'; expectCmd = true; }
          // 命令名（行首或操作符/前缀后）
          else if (expectCmd) { span.className = 'tk-cmd'; expectCmd = false; }
          // 选项（-t, --long）
          else if (/^[-]{1,2}[A-Za-z0-9][A-Za-z0-9-]*$/.test(part)) { span.className = 'tk-opt'; }
          // 路径
          else if (/^\//.test(part)) { span.className = 'tk-path'; }
          // IP:PORT
          else if (/^\d{1,3}(?:\.\d{1,3}){3}(?::\d+)?$/.test(part)) { span.className = 'tk-ip'; }
          // 数字/纯数值
          else if (/^\d+(?:\.\d+)?$/.test(part)) { span.className = 'tk-num'; }
          span.textContent = part;
          frag.appendChild(span);
        });
        line.textContent = '';
        line.appendChild(frag);
      });
    });
  }
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', enhanceShellBlocks);
  } else {
    enhanceShellBlocks();
  }
})();
</script>

<style>
/* ========== CSS变量定义 ========== */
/* 作用: 定义全局颜色变量，便于主题切换和统一管理 */
:root {
    --code-bg-custom: #f8f9fa;
    --code-text-custom: #24292e;
    --code-border-custom: #e1e4e8;
    --code-comment: #6b7280;
    --code-keyword: #ff79c6;
    --code-string: #22c55e;
    --code-function: #0ea5e9;
    --code-number: #8b5cf6;
    --code-builtin: #f59e0b;
}

.dark {
    --code-bg-custom: #0d1117;
    --code-text-custom: #e6edf3;
    --code-border-custom: #30363d;
    --code-comment: #8b95a5;
    --code-keyword: #ff79c6;
    --code-string: #50fa7b;
    --code-function: #8be9fd;
    --code-number: #bd93f9;
    --code-builtin: #ffa657;
}

/* ========== 代码块样式 ========== */
/* 重置所有代码块相关的背景和边框，避免主题默认样式的干扰 */
.post-content .highlight:not(table),
.post-content .highlight,
.post-content pre,
.post-content pre code,
.chroma,
div.highlight {
    background: none !important;
    border: none !important;
    margin: 0 !important;
    padding: 0 !important;
    border-radius: 0 !important;
}

/* 代码块容器样式 */
.post-content div.highlight {
    background: var(--code-bg-custom) !important;
    color: var(--code-text-custom) !important;
    border: 1px solid var(--code-border-custom) !important;
    border-radius: 8px !important;
    padding: 16px !important;
    margin: 1.5em 0 !important;
    overflow-x: auto !important;
    position: relative !important;
}

.post-content div.highlight pre,
.post-content div.highlight pre code {
    background: transparent !important;
    color: inherit !important;
    border: none !important;
    margin: 0 !important;
    padding: 0 !important;
    border-radius: 0 !important;
    display: block !important;
}

/* 内联代码样式 */
.post-content code:not(.chroma code):not(pre code) {
    background: var(--code-bg) !important;
    color: var(--content) !important;
    padding: 2px 6px !important;
    border-radius: 4px !important;
    font-size: 0.9em !important;
    border: 1px solid var(--border) !important;
    font-family: 'SF Mono', Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace !important;
}

/* 语法高亮颜色 */
.chroma .c, .chroma .c1, .chroma .cm, .chroma .cs { color: var(--code-comment) !important; font-style: italic !important; }
.chroma .k, .chroma .kd, .chroma .kn, .chroma .kp, .chroma .kr, .chroma .kt { color: var(--code-keyword) !important; font-weight: bold !important; }
.chroma .s, .chroma .s1, .chroma .s2, .chroma .sb, .chroma .sc, .chroma .sd, .chroma .se, .chroma .sh, .chroma .si, .chroma .sx { color: var(--code-string) !important; }
.chroma .nf, .chroma .fm { color: var(--code-function) !important; font-weight: bold !important; }
.chroma .m, .chroma .mb, .chroma .mf, .chroma .mh, .chroma .mi, .chroma .mo { color: var(--code-number) !important; }
.chroma .nb, .chroma .bp { color: var(--code-builtin) !important; }
.chroma * { background: transparent !important; }

/* 复制按钮样式 */
.copy-code { background: rgba(0, 0, 0, 0.5) !important; color: white !important; font-size: 12px !important; padding: 4px 8px !important; border-radius: 4px !important; }
.dark .copy-code { background: rgba(255, 255, 255, 0.8) !important; color: black !important; }

/* 命令行着色增强 */
.tk-cmd { color: #1f6feb !important; font-weight: 700 !important; }
.tk-prefix { color: #0ea5e9 !important; font-weight: 700 !important; }
.tk-opt { color: #a78bfa !important; }
.tk-path { color: #10b981 !important; }
.tk-op { color: #f43f5e !important; font-weight: 700 !important; }
.tk-num, .tk-ip { color: #8b5cf6 !important; }

/* ========== 表格和列表样式 ========== */
/* 调整列表项间距和布局 */
.post-content ol, .post-content ul { margin-top: 0em !important; margin-left: 0.8em !important; margin-bottom: 1.5em !important; }
.post-content li { margin-top: 2px !important; margin-bottom: 10px !important; line-height: 1.4 !important; padding: 8px 0 !important; }
.post-content p + ol, .post-content p + ul { margin-top: 0em !important; }

/* 增加表格列间距和行间距，提高可读性 */
.post-content table td { padding: 5px 80px 5px 30px !important; line-height: 1.6 !important; white-space: nowrap !important; }
.post-content table th { padding: 10px 30px 10px 30px !important; line-height: 1.6 !important; white-space: nowrap !important; }
.post-content table { margin: 0.2em 0 1.6em 0 !important; border-spacing: 25px 8px !important; }

/* ========== 响应式布局 ========== */
/* 超宽屏显示器优化，确保内容不会过度拉伸 */
@media screen and (min-width: 1600px) {
    .main { max-width: calc(1300px + 48px) !important; }
    .nav { max-width: calc(1300px + 48px) !important; }
    .post-content-container { gap: 3rem !important; }
    .toc-sidebar { flex: 0 0 280px !important; }
}

@media screen and (min-width: 1920px) {
    .main { max-width: calc(1500px + 48px) !important; }
    .nav { max-width: calc(1500px + 48px) !important; }
    .post-content-container { gap: 4rem !important; }
    .toc-sidebar { flex: 0 0 300px !important; }
}

@media screen and (min-width: 2560px) {
    .main { max-width: calc(1700px + 48px) !important; }
    .nav { max-width: calc(1700px + 48px) !important; }
    .post-content-container { gap: 5rem !important; }
    .toc-sidebar { flex: 0 0 320px !important; }
}

/* 确保在超宽屏上内容不会过于拉伸 */
@media screen and (min-width: 1600px) {
    .post-content { max-width: 100% !important; line-height: 1.8 !important; }
    .post-content p { max-width: 100% !important; }
    .post-content img { max-width: 100% !important; height: auto !important; }
    .post-content figure { max-width: 100% !important; }
}

/* ========== 首页专用样式 ========== */
/* 重要说明：Hugo PaperMod主题的首页使用 class="list" 而不是 class="home" */
/* 排除terms和archives页面，确保只对真正的首页生效 */

/* 首页背景图片和半透明层 - 仅大屏幕生效 */
@media screen and (min-width: 769px) {
    body.list:not(.terms):not(.archives) {
        background-image: url('/images/background/homepage/light_mode.jpeg') !important;
        background-size: cover !important; 
        background-position: center !important;
        background-attachment: fixed !important; 
        background-repeat: no-repeat !important;
        min-height: 100vh !important;
    }
    
    body.list:not(.terms):not(.archives).dark {
        background-image: url('/images/background/homepage/dark_mode.jpeg') !important;
    }

    /* 半透明遮罩层 */
    body.list:not(.terms):not(.archives)::before {
        content: '' !important; 
        position: fixed !important; 
        top: 0 !important; 
        left: 0 !important;
        width: 100% !important; 
        height: 100% !important; 
        /* 浅色模式半透明背景 透明度从0.88到0.86 */
        background-color: rgba(208, 208, 208, 0.86) !important;
        z-index: 0 !important; 
        pointer-events: none !important;
    }

    /* 深色模式半透明背景 透明度从0.741到0.66 */
    body.dark.list:not(.terms):not(.archives)::before {
        background-color: rgba(0, 0, 0, 0.66) !important;
    }
}

/* 首页布局和文章居中 - 关键样式 */
/* 使用高优先级选择器确保覆盖主题默认样式 */
html body.list:not(.terms):not(.archives) .main {
    min-height: 100vh !important; 
    background-color: transparent !important;
    margin: 60px 0 0 !important; /* 减少顶部margin从120px到60px */
    width: 100% !important; 
    max-width: 100% !important;
    padding: 20px 20px !important; /* 减少顶部padding从40px到20px */
    box-sizing: border-box !important;
    display: flex !important; 
    flex-direction: column !important; 
    align-items: center !important;
}

/* 首页文章条目标题和内容居中 */
html body.list:not(.terms):not(.archives) .main .post-entry {
    max-width: 1300px !important; /* 增加宽度从800px到1000px */
    width: 100% !important;
    margin: 0 auto 1.5rem auto !important; /* 减小高度：减小底部间距从2rem到1.5rem */
    text-align: center !important;
    background-color: rgba(255, 255, 255, 0.2) !important;
    backdrop-filter: blur(0px) !important;
    /* 确保完全居中 */
    left: 0 !important; 
    right: 0 !important;
    position: relative !important;
}

/* 首页文章内部元素居中 */
html body.list:not(.terms):not(.archives) .main .post-entry .entry-header,
html body.list:not(.terms):not(.archives) .main .post-entry .entry-content,
html body.list:not(.terms):not(.archives) .main .post-entry .entry-footer {
    text-align: center !important;
    /* 确保内容完全居中 */
    margin-left: auto !important; 
    margin-right: auto !important;
    display: block !important;
}

/* 减小首页文章内部元素的间距 */
html body.list:not(.terms):not(.archives) .main .post-entry .entry-header {
    margin-bottom: 0.8rem !important; /* 减小标题底部间距 */
}

html body.list:not(.terms):not(.archives) .main .post-entry .entry-content {
    margin-bottom: 0.8rem !important; /* 减小内容底部间距 */
    line-height: 1.5 !important; /* 调整行高 */
    /* 限制显示为两行文字 */
    display: -webkit-box !important;
    -webkit-line-clamp: 2 !important;
    -webkit-box-orient: vertical !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    max-height: 3em !important; /* 1.5行高 × 2行 = 3em */
}

html body.list:not(.terms):not(.archives) .main .post-entry .entry-footer {
    margin-bottom: 0 !important; /* 移除底部间距 */
}

/* 首页分页居中 */
html body.list:not(.terms):not(.archives) .main .pagination {
    display: flex !important; 
    justify-content: center !important; 
    width: 100% !important; 
    margin-top: 2rem !important;
}

/* 深色模式下的首页文章背景 */
body.dark.list:not(.terms):not(.archives) .main .post-entry { 
    background-color: rgba(40, 40, 40, 0.2) !important; 
}

/* 首页封面图片响应式显示 */
/* 小屏幕显示封面图片 */
@media screen and (max-width: 768px) {
    body.list:not(.terms):not(.archives) .entry-cover { 
        display: block !important; 
    }
    body.list:not(.terms):not(.archives) .entry-cover img { 
        max-width: 100% !important; 
        height: auto !important; 
        margin: 0 auto !important; 
        display: block !important; 
    }
}

/* 大屏幕隐藏封面图片 */
@media screen and (min-width: 769px) {
    body.list:not(.terms):not(.archives) .entry-cover { 
        display: none !important; 
    }
    body.list:not(.terms):not(.archives) .entry-header h2 { 
        font-size: 28px !important; 
        line-height: 1.4 !important; 
    }
    body.list:not(.terms):not(.archives) .entry-content { 
        font-size: 16px !important; 
        line-height: 1.5 !important; /* 统一行高为1.5 */
        margin: 12px 0 !important;
        /* 限制显示为两行文字 */
        display: -webkit-box !important;
        -webkit-line-clamp: 2 !important;
        -webkit-box-orient: vertical !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        max-height: 3em !important; /* 1.5行高 × 2行 = 3em */
    }
    body.list:not(.terms):not(.archives) .entry-footer { 
        font-size: 14px !important; 
    }
    body.list:not(.terms):not(.archives) .post-entry { 
        margin-bottom: 1.5rem !important; /* 减小底部间距 */
        padding: 1.2rem !important; /* 减小内边距 */
    }
}

/* 超大屏幕字体优化 */
@media screen and (min-width: 1600px) {
    body.list:not(.terms):not(.archives) .entry-header h2 { 
        font-size: 30px !important; 
    }
    body.list:not(.terms):not(.archives) .entry-content { 
        font-size: 17px !important; 
        line-height: 1.5 !important; /* 统一行高为1.5 */
        /* 限制显示为两行文字 */
        display: -webkit-box !important;
        -webkit-line-clamp: 2 !important;
        -webkit-box-orient: vertical !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        max-height: 3.4em !important; /* 1.7行高 × 2行 = 3.4em */
    }
    body.list:not(.terms):not(.archives) .post-entry { 
        margin-bottom: 2rem !important; /* 减小底部间距 */
        padding: 1.5rem !important; /* 减小内边距 */
    }
}

/* ========== 通用页面样式 ========== */
/* 导航栏固定在顶端 */
.header {
    position: fixed !important; 
    top: 0 !important; 
    left: 0 !important; 
    right: 0 !important;
    width: 100% !important; 
    max-width: 100% !important; 
    z-index: 1000 !important;
    background-color: rgba(255, 255, 255, 0.9) !important;
    backdrop-filter: blur(10px) !important; 
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1) !important;
    box-sizing: border-box !important; 
    padding: 0 !important; 
    margin: 0 !important;
}

body.dark .header {
    background-color: rgba(30, 30, 30, 0.88) !important;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3) !important;
}

/* 通用内容区域样式 */
.main, .footer {
    position: relative !important; 
    z-index: 1 !important; 
    background-color: transparent !important;
}

/* 非首页的内容区域样式 */
body:not(.list) .main {
    background-color: transparent !important; 
    border-radius: 0 !important;
    margin: 10px 0 0 !important; 
    min-height: 100vh !important;
    width: 100% !important; 
    padding: 40px 20px !important; 
    box-sizing: border-box !important;
}

body.dark .main { 
    background-color: transparent !important; 
}

/* 列表页面（非首页）的样式 */
.list .main {
    background-color: transparent !important; 
    padding: 40px 20px !important;
    border-radius: 0 !important; 
    margin: 40px 0 0 !important;
    min-height: 100vh !important; 
    width: 100% !important; 
    box-sizing: border-box !important;
}

body.dark .list .main { 
    background-color: transparent !important; 
}

/* 通用文章条目样式 - 仅对非首页生效 */
/* 重要：使用:not(.list)避免覆盖首页样式 */
body:not(.list) .post-entry {
    background-color: rgba(255, 255, 255, 0.2) !important; 
    backdrop-filter: blur(0px) !important;
}

body.dark:not(.list) .post-entry { 
    background-color: rgba(40, 40, 40, 0.2) !important; 
}

/* ========== 层级管理 ========== */
/* 确保各元素的正确层级，避免遮挡问题 */
.main, .page-header, .post-entry, .footer, .nav {
    position: relative !important; 
    z-index: 1 !important;
}
</style>

<!-- ========== 目录自动聚焦脚本 ========== -->
<!-- 功能: 当用户滚动页面时，自动高亮目录中对应的标题，并自动滚动到可见位置 -->
<script>
(function() {
    function initTocAutoFocus() {
        const headings = document.querySelectorAll('.post-content h1, .post-content h2, .post-content h3, .post-content h4, .post-content h5, .post-content h6');
        const tocLinks = document.querySelectorAll('.toc a');
        
        if (headings.length === 0 || tocLinks.length === 0) return;
        
        function clearHighlights() {
            tocLinks.forEach(link => {
                link.style.backgroundColor = ''; 
                link.style.color = ''; 
                link.style.padding = ''; 
                link.style.borderRadius = '';
            });
        }
        
        function highlightLink(index) {
            clearHighlights();
            if (tocLinks[index]) {
                tocLinks[index].style.backgroundColor = '#0366d6'; 
                tocLinks[index].style.color = 'white';
                tocLinks[index].style.padding = '2px 6px'; 
                tocLinks[index].style.borderRadius = '4px';
                scrollToTocLink(tocLinks[index]);
            }
        }
        
        function scrollToTocLink(link) {
            // 尝试多个可能的容器选择器，提高兼容性
            const possibleContainers = [
                link.closest('.toc'), 
                link.closest('.toc-sidebar'), 
                link.closest('.inner'), 
                link.closest('aside'), 
                link.parentElement
            ];
            let tocContainer = null;
            for (const container of possibleContainers) {
                if (container && container.scrollHeight > container.clientHeight) {
                    const style = window.getComputedStyle(container);
                    if (style.overflow === 'auto' || style.overflow === 'scroll' || style.overflowY === 'auto' || style.overflowY === 'scroll') {
                        tocContainer = container; 
                        break;
                    }
                }
            }
            if (!tocContainer) return;
            
            const linkRect = link.getBoundingClientRect(); 
            const containerRect = tocContainer.getBoundingClientRect();
            const linkTop = linkRect.top - containerRect.top + tocContainer.scrollTop;
            const linkBottom = linkTop + linkRect.height; 
            const containerHeight = containerRect.height;
            let targetScrollTop = tocContainer.scrollTop;
            
            // 计算目标滚动位置，确保链接在可视区域内
            if (linkTop < tocContainer.scrollTop + 20) {
                targetScrollTop = Math.max(0, linkTop - 20);
            } else if (linkBottom > tocContainer.scrollTop + containerHeight - 20) {
                targetScrollTop = Math.min(tocContainer.scrollHeight - containerHeight, linkBottom - containerHeight + 20);
            }
            
            // 如果需要滚动，则执行滚动
            if (Math.abs(targetScrollTop - tocContainer.scrollTop) > 5) {
                tocContainer.scrollTop = targetScrollTop;
            }
        }
        
        function checkScroll() {
            const scrollPosition = window.scrollY + 100;
            let currentIndex = -1; 
            let closestDistance = Infinity;
            
            headings.forEach((heading, index) => {
                const headingTop = heading.offsetTop; 
                const distance = Math.abs(scrollPosition - headingTop);
                if (distance < closestDistance && scrollPosition >= headingTop) { 
                    closestDistance = distance; 
                    currentIndex = index; 
                }
            });
            
            if (currentIndex === -1 && headings.length > 0) {
                currentIndex = 0;
            }
            if (currentIndex >= 0) {
                highlightLink(currentIndex);
            }
        }
        
        // 节流函数，避免频繁触发
        function throttle(func, limit) {
            let inThrottle; 
            return function() {
                const args = arguments; 
                const context = this;
                if (!inThrottle) { 
                    func.apply(context, args); 
                    inThrottle = true; 
                    setTimeout(() => inThrottle = false, limit); 
                }
            }
        }
        
        // 监听滚动事件
        window.addEventListener('scroll', throttle(checkScroll, 150)); 
        checkScroll();
        
        // 点击目录链接时平滑滚动到对应标题
        tocLinks.forEach((link, index) => {
            link.addEventListener('click', (e) => {
                e.preventDefault(); 
                const targetId = link.getAttribute('href').substring(1);
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                }
            });
        });
    }
    
    // 确保页面完全加载后再初始化
    if (document.readyState === 'complete') {
        setTimeout(initTocAutoFocus, 500);
    } else {
        window.addEventListener('load', () => setTimeout(initTocAutoFocus, 500));
    }
})();
</script>

<!-- 引入自定义CSS样式 -->
<link rel="stylesheet" href="{{ "css/custom.css" | absURL }}">